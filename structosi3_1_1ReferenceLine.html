<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.13"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>open_simulation_interface: osi3::ReferenceLine Struct Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    extensions: ["tex2jax.js"],
    jax: ["input/TeX","output/HTML-CSS"],
});
</script><script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">open_simulation_interface
   &#160;<span id="projectnumber">master(700133d)</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.13 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('structosi3_1_1ReferenceLine.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="summary">
<a href="#nested-classes">Classes</a> &#124;
<a href="#pub-attribs">Public Attributes</a> &#124;
<a href="structosi3_1_1ReferenceLine-members.html">List of all members</a>  </div>
  <div class="headertitle">
<div class="title">osi3::ReferenceLine Struct Reference</div>  </div>
</div><!--header-->
<div class="contents">

<p>A reference line for defining a non-euclidean ST coordinate system.  
 <a href="structosi3_1_1ReferenceLine.html#details">More...</a></p>
<div class="dynheader">
Collaboration diagram for osi3::ReferenceLine:</div>
<div class="dyncontent">
<div class="center"><img src="structosi3_1_1ReferenceLine__coll__graph.png" border="0" usemap="#osi3_1_1ReferenceLine_coll__map" alt="Collaboration graph"/></div>
<map name="osi3_1_1ReferenceLine_coll__map" id="osi3_1_1ReferenceLine_coll__map">
<area shape="rect" id="node2" href="structosi3_1_1Identifier.html" title="A common identifier (ID), represented as an integer. " alt="" coords="8,221,123,247"/>
<area shape="rect" id="node4" href="structosi3_1_1ReferenceLine_1_1ReferenceLinePoint.html" title="A point on the reference line. " alt="" coords="147,213,301,255"/>
<area shape="rect" id="node5" href="structosi3_1_1Vector3d.html" title="A cartesian 3D vector for positions, velocities or accelerations or its uncertainties. " alt="" coords="295,124,409,151"/>
</map>
<center><span class="legend">[<a target="top" href="graph_legend.html">legend</a>]</span></center></div>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="nested-classes"></a>
Classes</h2></td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="structosi3_1_1ReferenceLine_1_1ReferenceLinePoint.html">ReferenceLinePoint</a></td></tr>
<tr class="memdesc:"><td class="mdescLeft">&#160;</td><td class="mdescRight">A point on the reference line.  <a href="structosi3_1_1ReferenceLine_1_1ReferenceLinePoint.html#details">More...</a><br /></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="pub-attribs"></a>
Public Attributes</h2></td></tr>
<tr class="memitem:a1261e89c71c3186007c4e478151585d9"><td class="memItemLeft" align="right" valign="top">optional <a class="el" href="structosi3_1_1Identifier.html">Identifier</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="structosi3_1_1ReferenceLine.html#a1261e89c71c3186007c4e478151585d9">id</a> = 1</td></tr>
<tr class="memdesc:a1261e89c71c3186007c4e478151585d9"><td class="mdescLeft">&#160;</td><td class="mdescRight">The ID of the reference line.  <a href="#a1261e89c71c3186007c4e478151585d9">More...</a><br /></td></tr>
<tr class="separator:a1261e89c71c3186007c4e478151585d9"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a22bc783194f82536cb99965345a7af72"><td class="memItemLeft" align="right" valign="top">repeated <a class="el" href="structosi3_1_1ReferenceLine_1_1ReferenceLinePoint.html">ReferenceLinePoint</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="structosi3_1_1ReferenceLine.html#a22bc783194f82536cb99965345a7af72">poly_line</a> = 2</td></tr>
<tr class="memdesc:a22bc783194f82536cb99965345a7af72"><td class="mdescLeft">&#160;</td><td class="mdescRight">Points comprising the polyline.  <a href="#a22bc783194f82536cb99965345a7af72">More...</a><br /></td></tr>
<tr class="separator:a22bc783194f82536cb99965345a7af72"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p>A reference line for defining a non-euclidean ST coordinate system. </p>
<p>A reference line is a 3D polyline, used for generating a non-euclidean ST coordinate system.</p>
<p>Notes on design decisions:</p><ul>
<li>This is a polyline, and not some more complex curve. The advantage of a polyline is that it is very simple to generate from various map formats, and it is also easy to handle. The downside is that a polyline has no direct curvature, and even the angle is not continuous (only C0 smooth). In the author's experience, the benefits of a polyline outweigh the costs. </li>
</ul>
</div><h2 class="groupheader">Member Data Documentation</h2>
<a id="a1261e89c71c3186007c4e478151585d9"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a1261e89c71c3186007c4e478151585d9">&#9670;&nbsp;</a></span>id</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">optional <a class="el" href="structosi3_1_1Identifier.html">Identifier</a> osi3::ReferenceLine::id = 1</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>The ID of the reference line. </p>
<dl class="section note"><dt>Note</dt><dd>Note ID is global unique.</dd></dl>
<dl class="section user"><dt>Rules</dt><dd><div class="fragment"><div class="line">is_globally_unique</div></div><!-- fragment --> </dd></dl>

</div>
</div>
<a id="a22bc783194f82536cb99965345a7af72"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a22bc783194f82536cb99965345a7af72">&#9670;&nbsp;</a></span>poly_line</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">repeated <a class="el" href="structosi3_1_1ReferenceLine_1_1ReferenceLinePoint.html">ReferenceLinePoint</a> osi3::ReferenceLine::poly_line = 2</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Points comprising the polyline. </p>
<p>At least 2 points must be given. The polyline is defined as the lines between consecutive points. Each point has an S coordinate.</p>
<h2>Rules on the S position</h2>
<p>There are a few requirements on the S position:</p><ul>
<li>Later points in the list must have strictly larger S coordinates than earlier points.</li>
<li>For consecutive points, the S difference between them must be at least as large as the 2D euclidean distance between the points (2D distance == euclidean distance between the points taking only X and Y into account).</li>
<li>The S distance between two points may be larger than the 2D euclidean distance, but should be not much larger. It is allowed to be larger if the underlying reference line (e.g. in an OpenDRIVE map) is a curve, and thus the sampled reference line has a smaller length than the original curve.</li>
</ul>
<p>Together, these rules allow directly putting OpenDRIVE S coordinates into an OSI <a class="el" href="structosi3_1_1ReferenceLine.html" title="A reference line for defining a non-euclidean ST coordinate system. ">ReferenceLine</a>.</p>
<p>If the reference line approximates a curve (e.g. a clothoid in OpenDRIVE), the points must be chosen in a way that the lateral distance to the ideal line does not exceed 5cm. As shown in the following image:</p>
<div class="image">
<object type="image/svg+xml" data="line_approximation_error.svg">line_approximation_error.svg</object>
<div class="caption">
Approximation error</div></div>
<p>Approximation error green line.</p>
<p>Between two ReferenceLinePoints, both the world coordinate and the S coordinate is interpolated linearly. So each S value uniquely describes a point on the polyline.</p>
<h2>Extending the coordinate system infinitely</h2>
<p>For the purpose of this discussion, let's call the S position of the first point <code>sStart</code>, and the S position of the last point <code>sEnd</code>.</p>
<p>For some purposes, S positions outside the normally defined range (i.e. outside [<code>sStart</code>,<code>sEnd</code>]) need to be defined. For this purpose, the first line of the polyline is infinitely extended in negative S direction. Similarly, the last line of the polyline is infinitely extended beyond the last point. The S value of points outside [<code>sStart</code>,<code>sEnd</code>] is defined by the euclidean 2D distance from the start or end point, respectively. So if <code>sStart = 15</code>, and a point is on the line extended from the start position, with a 2D euclidean distance of 10 from the first point, then it has an S position of 5.</p>
<p>A point is "before" the reference line, if its s coordinate is &lt; <code>sStart</code>. A point is "after" the reference line, if its s coordinate is &gt; <code>sEnd</code>.</p>
<h2>Adding T coordinates</h2>
<p>To describe points that are not directly on the polyline, a T coordinate is added. T is the signed 2D distance (i.e. <code>hypot(A.X-B.X, A.Y-B.Y)</code>, if A and B are the two points) between the point to describe and the nearest point on the polyline (this point might either be on a line segment or at an edge between two line segments). The distance is positive if the point is left of the polyline (in definition direction), negative if it is right of it. The S position of such a point outside the reference line is the same as the S value of the nearest point on the polyline.</p>
<p>Notes:</p><ul>
<li>The "nearest point on the polyline" is determined in 3D (even if the resulting T value is only the 2D distance), in order to choose the correct point for 3D curves (think reference lines for roads in parking decks).</li>
<li>If there are several "nearest points", the one with the smallest S coordinate on the polyline is chosen.</li>
</ul>
<h2>Defining angles</h2>
<p>Sometimes an angle to a reference line is needed. This shall be defined as follows: First the nearest point on the polyline is determined, as described above. If this point is on a line segment, then the angle is calculated relative to the line segment on which the reference point lays. If the nearest point is at the edge between line segments, then the angle of the following line shall be chosen.</p>
<h2>Converting between world coordinates and ST coordinates</h2>
<p>The above rules define an ST coordinate system across the whole XY plane. Every XY position has a ST coordinate, but not necessarily a unique ST coordinate.</p>
<p>Example: </p><div class="image">
<object type="image/svg+xml" data="OSI_ReferenceLine1.svg">OSI_ReferenceLine1.svg</object>
</div>
<p>This shows a reference line (consisting of three points), and five points not on the reference line.</p>
<ul>
<li>For <code>P1</code>, the situation is clear, since there is exactly one nearest point on the polyline. The resulting ST coordinate uniquely maps back to <code>P1</code>.</li>
<li><code>P2</code> has multiple points "nearest points" on the polyline. As can be seen here, two ST coordinates map to <code>P2</code> (red and grey dotted line). Following the rules above, the one with the smallest S value is chosen (the red dotted line).</li>
<li><code>P3</code> has a unique "nearest point" on the polyline. However, multiple points map to the same ST coordinate as that of <code>P3</code>, e.g. <code>P4</code> (drawn in grey).</li>
<li>Finally, <code>P5</code> shows how the reference line is extended infinitely for points that are "outside" the reference line.</li>
</ul>
<p>The sampling of the polyline must be chosen such that the error when converting coordinates is "small enough". The exact needed precision is defined for each user, where the reference line is referenced.</p>
<h2>Creating reference lines</h2>
<p>When OSI is generated from OpenDRIVE, typically the reference lines will be taken directly from the road reference lines in OpenDRIVE, and sampled according to the accuracy requirements outlined above.</p>
<p>Other map formats may not have reference lines, so they will have to be synthesized by the tool generating OSI data. A few guidelines on this process:</p>
<ul>
<li>The reference line should follow the road</li>
<li>It is preferable to have the reference line in the center of the road (e.g. on a highway, it should be in the middle between the two driving directions). Rationale: this makes S differences better approximate euclidean distances, compared to having the reference line at one side of a curvy road.</li>
</ul>
<h2>Various notes</h2>
<p>Notes on OpenDRIVE compatibility: Ideally, one would want the polyline to be fully compatible with OpenDRIVE, so that calculations done for OpenDRIVE directly match those in OSI. There are a few difficulties with this:</p><ul>
<li>The T coordinate is nearly the same as for OpenDRIVE, but unfortunately not perfectly. In OpenDRIVE, if the road is tilted using superElevation, then the t coordinate system is tilted along, so the T coordinate is no longer calculated in the XY plane (as proposed for OSI). It doesn't seem feasable to implement the same tilting for OSI, so simulation tools will have to consider superElevation and convert the T coordinate accordingly: <code>t_OSI = t_OpenDRIVE * cos(alpha)</code>, where alpha is the superelevation angle.</li>
<li>The angle will not be perfectly the same, due to the use of line segments in OSI, and curves in OpenDRIVE. In the authors opinion, the difference will be negligible if the <a class="el" href="structosi3_1_1ReferenceLine.html#a22bc783194f82536cb99965345a7af72" title="Points comprising the polyline. ">poly_line</a> is suitably sampled.</li>
</ul>
<p>Notes on design decisions:</p><ul>
<li>The S coordinate is included directly, both for OpenDRIVE compatibility, and to speed up calculations.</li>
<li>The rules on S coordinates (e.g. the calculation in 2D space) are there to ensure OpenDRIVE compatibility.</li>
<li>The rules on T coordinates are there to ensure OpenDRIVE compatibility for lanes without superelevation, and to make it easier to convert between OSI and OpenDRIVE in case superelevation is present. </li>
</ul>

</div>
</div>
<hr/>The documentation for this struct was generated from the following file:<ul>
<li>osi_referenceline.proto</li>
</ul>
</div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><b>osi3</b></li><li class="navelem"><a class="el" href="structosi3_1_1ReferenceLine.html">ReferenceLine</a></li>
    <li class="footer">Generated by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.13 </li>
  </ul>
</div>
</body>
</html>
