syntax = "proto2";

option optimize_for = SPEED;

import "osi_version.proto";
import "osi_common.proto";

package osi3;

// \brief Host vehicle data is about the perception of the vehicle about its own internal states.
// It captures the knowledge the vehicle has internally, which can differ from the actual or global truth for various reasons.
// This message can also be understood as an interface container for the signals of a rest bus simulation.
//
// It consists of different messages categorizing the vehicle in:
// Basics, powertrain, brake system, steering, wheels and localization.
//
// \image html OSI_HostVehicle.svg
//
message HostVehicleData
{
    // The interface version used by the sender.
    //
    optional InterfaceVersion version = 9;

    // The timestamp of the host vehicle data. Zero time is arbitrary but must be
    // identical for all messages. Zero time does not need to coincide with
    // the unix epoch. Recommended is the starting time point of the
    // simulation or measurement.
    //
    // \note This is the point in time that the host vehicle data message becomes
    // available as snapshot from the board net information.
    //
    optional Timestamp timestamp = 10;

    // The ID of the host vehicle in any associated GroundTruth data.
    //
    optional Identifier host_vehicle_id = 11;

    // Deprecated: Will be removed in next major release. Moved to vehicle_localization.
    // Current estimated location based on GPS- and related navigation sensors.
    //
    // \note Note that dimension and base_polygon need not be set.
    //
    optional BaseMoving location = 1;

    // Deprecated: Will be removed in next major release. Moved to vehicle_localization.
    // Current estimated location error based on GPS and related navigation
    // sensors.
    //
    // \note Note that dimension and base_polygon need not be set.
    //
    optional BaseMoving location_rmse = 2;

    // The basic parameters of the vehicle.
    //
    optional VehicleBasics vehicle_basics = 3;

    // Interface regarding the powertrain.
    //
    optional VehiclePowertrain vehicle_powertrain = 4;

    // Interface regarding the brake system.
    //
    optional VehicleBrakeSystem vehicle_brake_system = 5;

    // Interface regarding the steering.
    //
    optional VehicleSteering vehicle_steering = 6;

    // Interface regarding the internal wheel states.
    //
    optional VehicleWheels vehicle_wheels = 7;

    // Interface regarding the localization.
    //
    optional VehicleLocalization vehicle_localization = 8;

    // State of driver assistance systems.
    //
    // This can include:
    //  - information presented to the driver, for example, parking sensors
    //  - warnings raised by the vehicle, for example, forward collision warning
    //  - corrective action taken by the vehicle, for example, auto emergency braking
    //
    repeated DriverAssistState driver_assist_state = 12;

    //
    // \brief The absolute base parameters of the vehicle. 
    //
    message VehicleBasics
    {
        // The total mass of the vehicle (curb weight).
        //
        // Unit: kg
        //
        // \par Reference:
        // Paragraph 42 of the German Road Traffic Admission Regulations (StVZO).
        //
        optional double curb_weight = 1;
    }

    //
    // \brief State description of the powertrain.
    //
    message VehiclePowertrain
    {
        // Position of the acceleration pedal.
        // Range: 0-1 (Unpressed - fully pressed)
        //
        optional double pedal_position_acceleration = 1;

        // Position of the clutch pedal.
        // Range: 0-1 (Unpressed - fully pressed)
        //
        optional double pedal_position_clutch = 2;

        // The actual gear of the transmission.
        // For example, a gear lever can be on "D" and the transmission on "4", but not the
        // other way around.
        //
        // The sign of this field is linked to the gear's mode as following:
        // - zero: neutral position
        // - positive: driving forward mode
        // - negative: reverse mode (generally -1, but few vehicles have more than 1
        //   reverse mode gears)
        //
        optional int32 gear_transmission = 3;

        // Information about the motor(s).
        //
        repeated Motor motor = 4;

        //
        // \brief A description of the motor states.
        //
        message Motor
        {
            // The type of the motor.
            //
            optional Type type = 1;

            // Revolutions per minute of the motor.
            //
            // Unit: 1/min
            //
            optional double rpm = 2;

            // Torque of the motor.
            //
            // Unit: N*m
            //
            optional double torque = 3;

            // Definition which type of motor is used.
            //
            enum Type
            {
                // The motor type is unknown.
                //
                TYPE_UNKNOWN = 0;

                // It is another motor type.
                //
                TYPE_OTHER = 1;

                // A motor working after the principle of Nicolaus Otto.
                //
                TYPE_OTTO = 2;

                // A motor working after the principle of Rudolf Diesel.
                //
                TYPE_DIESEL = 3;

                // A motor working electric.
                //
                TYPE_ELECTRIC = 4;
            }
        }
    }

    //
    // \brief The focus here is on the description of the brake system. 
    //
    message VehicleBrakeSystem
    {
        // Position of the brake pedal.
        // Range: 0-1 (Unpressed - fully pressed)
        //
        optional double pedal_position_brake = 1;
    }

    //
    // \brief The focus here is on the description of the steering train. 
    //
    message VehicleSteering
    {
        // Description of the steering wheel.
        //
        optional VehicleSteeringWheel vehicle_steering_wheel = 1;
    }

    //
    // \brief The focus here is on the description of internal wheel states.
    //
    message VehicleWheels
    {
        // Description of each wheel.
        //
        // \note OSI uses singular instead of plural for repeated field names.
        //
        repeated WheelData wheel_data = 1;

        //
        // \brief The focus here is on the description of internal wheel states.
        //
        message WheelData
        {
            // The axle which contains this wheel. A value of 0 represents the
            // foremost axle of the vehicle, with higher numbers ascending
            // towards the rearmost axle.
            //
            optional uint32 axle = 1;

            // The index of the wheel on the axle, counted in positive y- direction,
            // that is, right-to-left.
            //
            // For example, on a standard 2-axle, 4-wheel car, the rear-right
            // wheel would be (axle=1, index=0).
            // This concept also works for twin tires.
            //
            optional uint32 index = 2;

            // Rotation rate of the wheel based on the processed output of the hall sensor measurements at the wheel.
            // The rotation rate around the y-axis with respect to the wheel's coordinate system.
            // 
            // Unit: rad/s.
            //
            // The sign convention is defined using the right-hand rule.
            // It is applied on the y-axis of the vehicle's reference system, that is, the center of bounding box.
            // Counterclockwise is positive and clockwise is negative.
            //
            // \image html OSI_RotationRate.svg
            // \note The vehicle's reference coordinate system is only used to determine the sign convention of the rotation rate.
            //
            optional double rotation_rate = 3;

            // Contains the longitudinal, measured slip of the tire.
            // \par References:
            // - https://www.kfz-tech.de/Biblio/Formelsammlung/Schlupf.htm
            //
            // Unit: %
            //
            // The sign convention is defined using the right-hand rule.
            // It is applied on the y-axis of the vehicle's reference system, that is, the center of bounding box.
            // Counterclockwise is positive and clockwise is negative.
            //
            optional double slip = 4;
        }
    }

    //
    // \brief Current calculated and estimated location that can be based on GNSS and related navigation sensors.
    // This message does not contain the individual sensor values of the sensor technology.
    //
    // This message contains the most accurate information the vehicle knows about its position
    // available in the on-board network.
    // Because of this the values can differ from the "true" values calculated out of
    // GroundTruth::proj_string, GroundTruth::MovingObject::BaseMoving::position, GroundTruth::host_vehicle_id.
    //
    message VehicleLocalization
    {
        // Most accurate position information of the vehicle available in the on-board network.
        // The reference point for position, that is, the center (x,y,z) of the bounding box
        // in context to the global coordinate system.
        //
        optional Vector3d position = 1;

        // Most accurate orientation information of the vehicle available in the on-board network
        // in context to the global coordinate system.
        //
        optional Orientation3d orientation = 2;
 
        // Most accurate geodetic information of the vehicle available in the on-board network.
        //
        optional GeodeticPosition geodetic_position = 3;
    }

    //
    // \brief The driver assist state specifically relating to recognised
    // Advanced Driver Assistance Systems.
    //
    message DriverAssistState
    {
        // The particular feature being reported about.
        //
        optional AssistFeature assist_feature = 1;

        // Custom feature name.
        //
        // Only used if assist_feature is set to ASSIST_FEATURE_OTHER.
        //
        optional string custom_name = 2;

        // The activation state of the feature.
        //
        // This is whether the feature has actually been triggered, for
        // example, a warning has been raised, or additional braking is
        // in effect.
        //
        optional ActivationState activation_state = 3;

        // Custom activation state.
        //
        // Only used if the activation_state is set to ACTIVATION_STATE_OTHER.
        //
        optional string custom_activation_state = 4;

        // Custom detail.
        //
        // An opaque set of key-value pairs which capture any user specific
        // details that may be relevant.  This could include details about
        // how a warning was raised (dashboard, audible, etc.) or it could
        // be about settings which would influence evaluation, such as
        // sensitivity settings.
        //
        repeated KeyValuePair custom_detail = 5;

        // ADAS feature that is raising the notification.
        //
        // \note The naming convention is taken from the SAE guidance on ADAS
        // nomenclature:
        // https://www.sae.org/binaries/content/assets/cm/content/miscellaneous/adas-nomenclature.pdf
        //
        enum AssistFeature
        {
            // Unknown feature, should not be used.
            //
            ASSIST_FEATURE_UNKNOWN = 0;

            // Custom feature, see custom_name.
            //
            ASSIST_FEATURE_OTHER = 1;

            // Blind spot warning.
            //
            ASSIST_FEATURE_BLIND_SPOT_WARNING = 2;

            // Forward collision warning.
            //
            ASSIST_FEATURE_FORWARD_COLLISION_WARNING = 3;

            // Lane departure warning.
            //
            ASSIST_FEATURE_LANE_DEPARTURE_WARNING = 4;

            // Parking collision warning.
            //
            ASSIST_FEATURE_PARKING_COLLISION_WARNING = 5;

            // Rear cross-traffic warning
            //
            ASSIST_FEATURE_REAR_CROSS_TRAFFIC_WARNING = 6;

            // Automatic emergency braking
            //
            ASSIST_FEATURE_AUTOMATIC_EMERGENCY_BRAKING = 7;

            // Emergency steering
            //
            ASSIST_FEATURE_AUTOMATIC_EMERGENCY_STEERING = 8;

            // Reverse automatic emergency braking
            //
            ASSIST_FEATURE_REVERSE_AUTOMATIC_EMERGENCY_BRAKING = 9;

            // Adaptive cruise control
            //
            ASSIST_FEATURE_ADAPTIVE_CRUISE_CONTROL = 10;

            // Lane keeping assist
            //
            ASSIST_FEATURE_LANE_KEEPING_ASSIST = 11;

            // Active driving assistance
            //
            ASSIST_FEATURE_ACTIVE_DRIVING_ASSISTANCE = 12;

            // Backup camera
            //
            ASSIST_FEATURE_BACKUP_CAMERA = 13;

            // Surround view camera
            //
            ASSIST_FEATURE_SURROUND_VIEW_CAMERA = 14;

            // Active parking assistance
            //
            ASSIST_FEATURE_ACTIVE_PARKING_ASSISTANCE = 15;

            // Remote parking assistance
            //
            ASSIST_FEATURE_REMOTE_PARKING_ASSISTANCE = 16;

            // Trailer assistance
            //
            ASSIST_FEATURE_TRAILER_ASSISTANCE = 17;

            // Automatic high beams
            //
            ASSIST_FEATURE_AUTOMATIC_HIGH_BEAMS = 18;

            // Driver monitoring
            //
            ASSIST_FEATURE_DRIVER_MONITORING = 19;

            // Head up display
            //
            ASSIST_FEATURE_HEAD_UP_DISPLAY = 20;

            // Night vision
            //
            ASSIST_FEATURE_NIGHT_VISION = 21;
        }

        // The activation state of a feature.
        //
        // \note Not all of these will be applicable for all vehicles
        // and features.
        //
        enum ActivationState
        {
            // An unknown activation state, this should not be used.
            //
            ACTIVATION_STATE_UNKNOWN = 0;

            // Used for custom states not covered by the definitions below.
            //
            // A string state can be specified in custom_activation_state.
            //
            ACTIVATION_STATE_OTHER = 1;

            // The feature has been disabled.
            //
            ACTIVATION_STATE_TURNED_OFF = 2;

            // The feature has errored in some way that renders it ineffective.
            //
            ACTIVATION_STATE_ERRORED = 3;

            // The feature is enabled but conditions have not caused it to be
            // triggered, for example, no vehicles in front to trigger a FCW.
            //
            ACTIVATION_STATE_STANDBY = 4;

            // The feature is currently active, for example, a warning is being
            // shown to the driver, or emergency braking is being applied/
            //
            ACTIVATION_STATE_ACTIVE = 5;

            // The feature would be ACTIVE, but the user has show sufficient
            // input to override, for example, by applying throttle or steering
            // input.
            //
            ACTIVATION_STATE_ACTIVE_DRIVER_OVERRIDE = 6;
        }
    }
}
